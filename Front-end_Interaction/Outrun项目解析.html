<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <!-- 字符集和浏览器兼容性 -->
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">

<!-- SEO Meta Tags -->
<meta name="description" content="Web3顶级学习平台 | 智能合约开发、链上交互和前端DApp开发实战教程，从入门到精通！">
<meta name="keywords" content="Web3, 区块链, 智能合约, Solidity, DApp, 去中心化应用, 教程">
<meta name="author" content="Top3 Academy">

<!-- Open Graph -->
<meta property="og:title" content="Outrun项目解析 | Top3 Academy">
<meta property="og:description" content="Web3顶级学习平台 | 智能合约开发、链上交互和前端DApp开发实战教程，从入门到精通！">
<meta property="og:type" content="website">
<meta property="og:url" content="https://learnweb3.top/Front-end_Interaction/Outrun%E9%A1%B9%E7%9B%AE%E8%A7%A3%E6%9E%90.html">

<!-- 页面标题 -->
<title>Outrun项目解析 | Top3 Academy</title>

<!-- Favicon -->
<link rel="icon" type="image/png" href="/assets/img/logo.png">
<link rel="apple-touch-icon" href="/assets/img/logo.png">

<!-- Google Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<!-- 站点样式表 -->
<link rel="stylesheet" href="/assets/css/main.css">

<!-- 语法高亮 - Prism.js -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" id="prism-light">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css"
    id="prism-dark" disabled>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

<!-- 主题初始化脚本 (避免闪烁) -->
<script>
    (function () {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark');
        }
    })();
</script>
</head>

<body>
    <header>
    <div class="container">
        <div id="branding">
            <a href="/" class="logo-link">
                <img src="/assets/img/logo.png" alt="Top3 Academy Logo" class="logo">
                <span class="site-title">Top3 Academy</span>
            </a>
        </div>

        <nav id="mainNav">
            <ul>
                <li><a href="/smart_contract/">智能合约</a></li>
                <li><a href="/chain_interaction/">链上交互</a></li>
                <li><a href="/Front-end_Interaction/">前端交互</a></li>
                <li><a href="/friends/">友情链接</a></li>
            </ul>
        </nav>

        <div class="header-actions">
            <!-- 主题切换按钮 -->
            <button class="theme-toggle" id="themeToggle" aria-label="切换主题">
                <svg class="sun-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41l-1.06-1.06zm1.06-10.96c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z" />
                </svg>
                <svg class="moon-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-2.98 0-5.4-2.42-5.4-5.4 0-1.81.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z" />
                </svg>
            </button>

            <!-- 汉堡菜单按钮 (移动端) -->
            <button class="hamburger" id="menuToggle" aria-label="菜单">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </div>
</header>

    <!-- 侧边栏遮罩层 -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- 课程文档布局 -->
    <div class="course-document">
        <aside class="sidebar" id="sidebar">
            <h2>目录</h2>
            <nav class="lesson-nav">
                <ul>
                    
                    
                    
                    
                    
                    <li class="active" >
                        <a href="/Front-end_Interaction/Outrun%E9%A1%B9%E7%9B%AE%E8%A7%A3%E6%9E%90.html">Outrun项目解析</a>
                    </li>
                    
                    
                    
                    
                    
                </ul>
            </nav>
        </aside>

        <main class="content">
            <h2 id="项目架构分析">项目架构分析</h2>

<p>项目链接：<a href='https://github.com/OutrunFinance/Outrun-App'>https://github.com/OutrunFinance/Outrun-App</a></p>

<p>根据提供的代码片段和项目结构,我可以对这个项目进行以下分析:</p>

<ol>
  <li>技术栈:
    <ul>
      <li>前端框架: Next.js (React)</li>
      <li>UI组件库: NextUI</li>
      <li>状态管理: React Query</li>
      <li>区块链交互: wagmi, viem</li>
      <li>样式: Tailwind CSS</li>
      <li>类型检查: TypeScript</li>
    </ul>
  </li>
  <li>项目结构:
这是一个去中心化金融(DeFi)应用,主要功能包括:
    <ul>
      <li>代币交换(Swap)</li>
      <li>流动性提供(Liquidity)</li>
      <li>质押(Staking)</li>
      <li>代币发行(FFLaunch)</li>
    </ul>
  </li>
  <li>核心功能:
    <ul>
      <li>代币交换:实现了类似Uniswap V2的自动做市商(AMM)机制。</li>
      <li>流动性管理:允许用户添加和移除流动性。</li>
      <li>路由:实现了最优交易路径的计算。</li>
    </ul>
  </li>
</ol>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">public</span> <span class="k">static</span> <span class="nf">swapCallParameters</span><span class="p">(</span>
    <span class="nx">inputCurrency</span><span class="p">:</span> <span class="nx">Currency</span><span class="p">,</span>
    <span class="nx">outputCurrency</span><span class="p">:</span> <span class="nx">Currency</span><span class="p">,</span>
    <span class="nx">trade</span><span class="p">:</span> <span class="nx">Trade</span><span class="o">&lt;</span><span class="nx">Currency</span><span class="p">,</span> <span class="nx">Currency</span><span class="p">,</span> <span class="nx">TradeType</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="nx">options</span><span class="p">:</span> <span class="nx">TradeOptions</span> <span class="o">|</span> <span class="nx">TradeOptionsDeadline</span><span class="p">,</span>
  <span class="p">):</span> <span class="nx">SwapParameters</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">etherIn</span> <span class="o">=</span> <span class="nx">inputCurrency</span><span class="p">.</span><span class="nx">isNative</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">etherOut</span> <span class="o">=</span> <span class="nx">outputCurrency</span><span class="p">.</span><span class="nx">isNative</span><span class="p">;</span>
    <span class="c1">// the router does not support both ether in and out</span>
    <span class="nf">invariant</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">etherIn</span> <span class="o">&amp;&amp;</span> <span class="nx">etherOut</span><span class="p">),</span> <span class="dl">"</span><span class="s2">ETHER_IN_OUT</span><span class="dl">"</span><span class="p">);</span>
    <span class="nf">invariant</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="dl">"</span><span class="s2">ttl</span><span class="dl">"</span> <span class="k">in</span> <span class="nx">options</span><span class="p">)</span> <span class="o">||</span> <span class="nx">options</span><span class="p">.</span><span class="nx">ttl</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="dl">"</span><span class="s2">TTL</span><span class="dl">"</span><span class="p">);</span>

    <span class="kd">const</span> <span class="nx">to</span><span class="p">:</span> <span class="kr">string</span> <span class="o">=</span> <span class="nf">validateAndParseAddress</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">recipient</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">amountIn</span><span class="p">:</span> <span class="kr">string</span> <span class="o">=</span> <span class="nf">toHex</span><span class="p">(</span><span class="nx">trade</span><span class="p">.</span><span class="nf">maximumAmountIn</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">allowedSlippage</span><span class="p">));</span>
    <span class="kd">const</span> <span class="nx">amountOut</span><span class="p">:</span> <span class="kr">string</span> <span class="o">=</span> <span class="nf">toHex</span><span class="p">(</span><span class="nx">trade</span><span class="p">.</span><span class="nf">minimumAmountOut</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">allowedSlippage</span><span class="p">));</span>

    <span class="kd">const</span> <span class="nx">path</span><span class="p">:</span> <span class="kr">string</span><span class="p">[]</span> <span class="o">=</span> <span class="nx">trade</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">path</span><span class="p">.</span><span class="nf">map</span><span class="p">((</span><span class="nx">token</span><span class="p">:</span> <span class="nx">Token</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">token</span><span class="p">.</span><span class="nx">address</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">deadline</span> <span class="o">=</span>
      <span class="dl">"</span><span class="s2">ttl</span><span class="dl">"</span> <span class="k">in</span> <span class="nx">options</span>
        <span class="p">?</span> <span class="s2">`0x</span><span class="p">${(</span><span class="nb">Math</span><span class="p">.</span><span class="nf">floor</span><span class="p">(</span><span class="k">new</span> <span class="nc">Date</span><span class="p">().</span><span class="nf">getTime</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">+</span> <span class="nx">options</span><span class="p">.</span><span class="nx">ttl</span><span class="p">).</span><span class="nf">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">)}</span><span class="s2">`</span>
        <span class="p">:</span> <span class="s2">`0x</span><span class="p">${</span><span class="nx">options</span><span class="p">.</span><span class="nx">deadline</span><span class="p">.</span><span class="nf">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">)}</span><span class="s2">`</span><span class="p">;</span>

    <span class="kd">const</span> <span class="nx">useFeeOnTransfer</span> <span class="o">=</span> <span class="nc">Boolean</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">feeOnTransfer</span><span class="p">);</span>

    <span class="kd">let</span> <span class="nx">methodName</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">args</span><span class="p">:</span> <span class="p">(</span><span class="kr">string</span> <span class="o">|</span> <span class="kr">string</span><span class="p">[])[];</span>
    <span class="kd">let</span> <span class="nx">value</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="k">switch </span><span class="p">(</span><span class="nx">trade</span><span class="p">.</span><span class="nx">tradeType</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="nx">TradeType</span><span class="p">.</span><span class="nx">EXACT_INPUT</span><span class="p">:</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">etherIn</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if </span><span class="p">(</span><span class="nx">outputCurrency</span><span class="p">.</span><span class="nf">equals</span><span class="p">(</span><span class="nx">USDB</span><span class="p">[</span><span class="nx">outputCurrency</span><span class="p">.</span><span class="nx">chainId</span><span class="p">]))</span> <span class="p">{</span>
            <span class="nx">methodName</span> <span class="o">=</span> <span class="nx">useFeeOnTransfer</span> <span class="p">?</span> <span class="dl">"</span><span class="s2">swapExactETHForUSDBSupportingFeeOnTransferTokens</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">swapExactETHForUSDB</span><span class="dl">"</span><span class="p">;</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">methodName</span> <span class="o">=</span> <span class="nx">useFeeOnTransfer</span>
              <span class="p">?</span> <span class="dl">"</span><span class="s2">swapExactETHForTokensSupportingFeeOnTransferTokens</span><span class="dl">"</span>
              <span class="p">:</span> <span class="dl">"</span><span class="s2">swapExactETHForTokens</span><span class="dl">"</span><span class="p">;</span>
          <span class="p">}</span>

          <span class="c1">// (uint amountOutMin, address[] calldata path, address to, uint deadline)</span>
          <span class="nx">args</span> <span class="o">=</span> <span class="p">[</span><span class="nx">amountOut</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">deadline</span><span class="p">];</span>
          <span class="nx">value</span> <span class="o">=</span> <span class="nx">amountIn</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nx">etherOut</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if </span><span class="p">(</span><span class="nx">inputCurrency</span><span class="p">.</span><span class="nf">equals</span><span class="p">(</span><span class="nx">USDB</span><span class="p">[</span><span class="nx">inputCurrency</span><span class="p">.</span><span class="nx">chainId</span><span class="p">]))</span> <span class="p">{</span>
            <span class="nx">methodName</span> <span class="o">=</span> <span class="nx">useFeeOnTransfer</span> <span class="p">?</span> <span class="dl">"</span><span class="s2">swapExactUSDBForETHSupportingFeeOnTransferTokens</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">swapExactUSDBForETH</span><span class="dl">"</span><span class="p">;</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">methodName</span> <span class="o">=</span> <span class="nx">useFeeOnTransfer</span>
              <span class="p">?</span> <span class="dl">"</span><span class="s2">swapExactTokensForETHSupportingFeeOnTransferTokens</span><span class="dl">"</span>
              <span class="p">:</span> <span class="dl">"</span><span class="s2">swapExactTokensForETH</span><span class="dl">"</span><span class="p">;</span>
          <span class="p">}</span>

          <span class="c1">// (uint amountIn, uint amountOutMin, address[] calldata path, address to, uint deadline)</span>
          <span class="nx">args</span> <span class="o">=</span> <span class="p">[</span><span class="nx">amountIn</span><span class="p">,</span> <span class="nx">amountOut</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">deadline</span><span class="p">];</span>
          <span class="nx">value</span> <span class="o">=</span> <span class="nx">ZERO_HEX</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nx">inputCurrency</span><span class="p">.</span><span class="nf">equals</span><span class="p">(</span><span class="nx">USDB</span><span class="p">[</span><span class="nx">inputCurrency</span><span class="p">.</span><span class="nx">chainId</span><span class="p">]))</span> <span class="p">{</span>
          <span class="nx">methodName</span> <span class="o">=</span> <span class="nx">useFeeOnTransfer</span>
            <span class="p">?</span> <span class="dl">"</span><span class="s2">swapExactUSDBForTokensSupportingFeeOnTransferTokens</span><span class="dl">"</span>
            <span class="p">:</span> <span class="dl">"</span><span class="s2">swapExactUSDBForTokens</span><span class="dl">"</span><span class="p">;</span>
          <span class="c1">// (uint amountIn, uint amountOutMin, address[] calldata path, address to, uint deadline)</span>
          <span class="nx">args</span> <span class="o">=</span> <span class="p">[</span><span class="nx">amountIn</span><span class="p">,</span> <span class="nx">amountOut</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">deadline</span><span class="p">];</span>
          <span class="nx">value</span> <span class="o">=</span> <span class="nx">ZERO_HEX</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nx">outputCurrency</span><span class="p">.</span><span class="nf">equals</span><span class="p">(</span><span class="nx">USDB</span><span class="p">[</span><span class="nx">outputCurrency</span><span class="p">.</span><span class="nx">chainId</span><span class="p">]))</span> <span class="p">{</span>
          <span class="nx">methodName</span> <span class="o">=</span> <span class="nx">useFeeOnTransfer</span>
            <span class="p">?</span> <span class="dl">"</span><span class="s2">swapExactTokensForUSDBSupportingFeeOnTransferTokens</span><span class="dl">"</span>
            <span class="p">:</span> <span class="dl">"</span><span class="s2">swapExactTokensForUSDB</span><span class="dl">"</span><span class="p">;</span>
          <span class="c1">// (uint amountIn, uint amountOutMin, address[] calldata path, address to, uint deadline)</span>
          <span class="nx">args</span> <span class="o">=</span> <span class="p">[</span><span class="nx">amountIn</span><span class="p">,</span> <span class="nx">amountOut</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">deadline</span><span class="p">];</span>
          <span class="nx">value</span> <span class="o">=</span> <span class="nx">ZERO_HEX</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">methodName</span> <span class="o">=</span> <span class="nx">useFeeOnTransfer</span>
            <span class="p">?</span> <span class="dl">"</span><span class="s2">swapExactTokensForTokensSupportingFeeOnTransferTokens</span><span class="dl">"</span>
            <span class="p">:</span> <span class="dl">"</span><span class="s2">swapExactTokensForTokens</span><span class="dl">"</span><span class="p">;</span>
          <span class="c1">// (uint amountIn, uint amountOutMin, address[] calldata path, address to, uint deadline)</span>
          <span class="nx">args</span> <span class="o">=</span> <span class="p">[</span><span class="nx">amountIn</span><span class="p">,</span> <span class="nx">amountOut</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">deadline</span><span class="p">];</span>
          <span class="nx">value</span> <span class="o">=</span> <span class="nx">ZERO_HEX</span><span class="p">;</span>
        <span class="p">}</span>
</code></pre></div></div>

<ol>
  <li>用户界面:
    <ul>
      <li>使用NextUI组件库构建现代化的UI界面。</li>
      <li>实现了代币选择器等自定义组件。</li>
    </ul>
  </li>
</ol>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">ArrowLeft</span><span class="p">,</span> <span class="nx">Search</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">lucide-react</span><span class="dl">"</span><span class="p">;</span>
</code></pre></div></div>

<ol>
  <li>区块链交互:
    <ul>
      <li>使用wagmi和viem库与以太坊兼容链进行交互。</li>
      <li>实现了代币数据和交易对数据的获取。</li>
    </ul>
  </li>
</ol>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Fetcher</span> <span class="p">{</span>
  <span class="cm">/**
   * Cannot be constructed.
   */</span>
  <span class="k">private</span> <span class="nf">constructor</span><span class="p">()</span> <span class="p">{}</span>

  <span class="cm">/**
   * Fetch information for a given token on the given chain, using the given viem provider.
   * @param chainId chain of the token
   * @param address address of the token on the chain
   * @param provider provider used to fetch the token
   * @param symbol symbol of the token
   * @param name optional name of the token
   */</span>
  <span class="k">public</span> <span class="k">static</span> <span class="k">async</span> <span class="nf">fetchTokenData</span><span class="p">(</span>
    <span class="nx">chainId</span><span class="p">:</span> <span class="nx">ChainId</span><span class="p">,</span>
    <span class="nx">address</span><span class="p">:</span> <span class="nx">Address</span><span class="p">,</span>
    <span class="nx">publicClient</span><span class="p">:</span> <span class="nx">PublicClient</span><span class="p">,</span>
    <span class="nx">symbol</span><span class="p">?:</span> <span class="kr">string</span><span class="p">,</span>
    <span class="nx">name</span><span class="p">?:</span> <span class="kr">string</span><span class="p">,</span>
  <span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Token</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">erc20</span> <span class="o">=</span> <span class="nf">getContract</span><span class="p">({</span>
      <span class="na">abi</span><span class="p">:</span> <span class="nx">erc20ABI</span><span class="p">,</span>
      <span class="nx">address</span><span class="p">,</span>
      <span class="na">client</span><span class="p">:</span> <span class="nx">publicClient</span><span class="p">,</span>
    <span class="p">});</span>
    <span class="kd">const</span> <span class="nx">parsedDecimals</span> <span class="o">=</span>
      <span class="k">typeof</span> <span class="nx">TOKEN_DECIMALS_CACHE</span><span class="p">?.[</span><span class="nx">chainId</span><span class="p">]?.[</span><span class="nx">address</span><span class="p">]</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">number</span><span class="dl">"</span>
        <span class="p">?</span> <span class="nx">TOKEN_DECIMALS_CACHE</span><span class="p">[</span><span class="nx">chainId</span><span class="p">][</span><span class="nx">address</span><span class="p">]</span>
        <span class="p">:</span> <span class="k">await</span> <span class="nx">erc20</span><span class="p">.</span><span class="nx">read</span><span class="p">.</span><span class="nf">decimals</span><span class="p">([]).</span><span class="nf">then</span><span class="p">((</span><span class="na">decimals</span><span class="p">:</span> <span class="kr">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="c1">// @ts-ignore</span>
            <span class="nx">TOKEN_DECIMALS_CACHE</span> <span class="o">=</span> <span class="p">{</span>
              <span class="p">...</span><span class="nx">TOKEN_DECIMALS_CACHE</span><span class="p">,</span>
              <span class="p">[</span><span class="nx">chainId</span><span class="p">]:</span> <span class="p">{</span>
                <span class="p">...</span><span class="nx">TOKEN_DECIMALS_CACHE</span><span class="p">?.[</span><span class="nx">chainId</span><span class="p">],</span>
                <span class="p">[</span><span class="nx">address</span><span class="p">]:</span> <span class="nx">decimals</span><span class="p">,</span>
              <span class="p">},</span>
            <span class="p">};</span>
            <span class="c1">// @ts-ignore</span>
            <span class="k">return</span> <span class="nx">decimals</span><span class="p">;</span>
          <span class="p">});</span>
    <span class="kd">let</span> <span class="nx">_symbol</span> <span class="o">=</span> <span class="dl">""</span><span class="p">;</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">symbol</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">_symbol</span> <span class="o">=</span> <span class="p">(</span><span class="k">await</span> <span class="nx">erc20</span><span class="p">.</span><span class="nx">read</span><span class="p">.</span><span class="nf">symbol</span><span class="p">().</span><span class="k">catch</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">address</span><span class="p">))</span> <span class="kd">as </span><span class="kr">string</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">Token</span><span class="p">(</span><span class="nx">chainId</span><span class="p">,</span> <span class="nx">address</span><span class="p">,</span> <span class="nx">parsedDecimals</span><span class="p">,</span> <span class="nx">symbol</span> <span class="o">||</span> <span class="nx">_symbol</span><span class="p">,</span> <span class="nx">name</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="cm">/**
   * Fetches information about a pair and constructs a pair from the given two tokens.
   * @param tokenA first token
   * @param tokenB second token
   * @param provider the provider to use to fetch the data
   */</span>
  <span class="k">public</span> <span class="k">static</span> <span class="k">async</span> <span class="nf">fetchPairData</span><span class="p">(</span><span class="nx">tokenA</span><span class="p">:</span> <span class="nx">Token</span><span class="p">,</span> <span class="nx">tokenB</span><span class="p">:</span> <span class="nx">Token</span><span class="p">,</span> <span class="nx">publicClient</span><span class="p">:</span> <span class="nx">PublicClient</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Pair</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="nf">invariant</span><span class="p">(</span><span class="nx">tokenA</span><span class="p">.</span><span class="nx">chainId</span> <span class="o">===</span> <span class="nx">tokenB</span><span class="p">.</span><span class="nx">chainId</span><span class="p">,</span> <span class="dl">"</span><span class="s2">CHAIN_ID</span><span class="dl">"</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">address</span> <span class="o">=</span> <span class="nx">Pair</span><span class="p">.</span><span class="nf">getAddress</span><span class="p">(</span><span class="nx">tokenA</span><span class="p">,</span> <span class="nx">tokenB</span><span class="p">)</span> <span class="kd">as </span><span class="nx">Address</span><span class="p">;</span>
    <span class="c1">// console.log(address);</span>

    <span class="kd">const</span> <span class="nx">pairContract</span> <span class="o">=</span> <span class="nf">getContract</span><span class="p">({</span>
      <span class="na">abi</span><span class="p">:</span> <span class="nx">PairABI</span><span class="p">,</span>
      <span class="nx">address</span><span class="p">,</span>
      <span class="na">client</span><span class="p">:</span> <span class="nx">publicClient</span><span class="p">,</span>
    <span class="p">});</span>
    <span class="kd">const</span> <span class="p">[</span><span class="nx">reserves0</span><span class="p">,</span> <span class="nx">reserves1</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">pairContract</span><span class="p">.</span><span class="nx">read</span><span class="p">.</span><span class="nf">getReserves</span><span class="p">();</span>
    <span class="kd">const</span> <span class="nx">balances</span> <span class="o">=</span> <span class="nx">tokenA</span><span class="p">.</span><span class="nf">sortsBefore</span><span class="p">(</span><span class="nx">tokenB</span><span class="p">)</span> <span class="p">?</span> <span class="p">[</span><span class="nx">reserves0</span><span class="p">,</span> <span class="nx">reserves1</span><span class="p">]</span> <span class="p">:</span> <span class="p">[</span><span class="nx">reserves1</span><span class="p">,</span> <span class="nx">reserves0</span><span class="p">];</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nc">Pair</span><span class="p">(</span>
      <span class="nx">CurrencyAmount</span><span class="p">.</span><span class="nf">fromRawAmount</span><span class="p">(</span><span class="nx">tokenA</span><span class="p">,</span> <span class="nx">balances</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">toString</span><span class="p">()),</span>
      <span class="nx">CurrencyAmount</span><span class="p">.</span><span class="nf">fromRawAmount</span><span class="p">(</span><span class="nx">tokenB</span><span class="p">,</span> <span class="nx">balances</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">toString</span><span class="p">()),</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<ol>
  <li>项目特点:
    <ul>
      <li>支持多链:项目似乎支持多个区块链网络,包括Blast和Blast Sepolia测试网。</li>
      <li>费用on-transfer:考虑了带有转账费用的代币。</li>
      <li>自定义路由:实现了针对特定代币(如USDB)的自定义交换路由。</li>
    </ul>
  </li>
  <li>开发工具:
    <ul>
      <li>使用pnpm作为包管理器</li>
      <li>使用ESLint进行代码质量控制</li>
      <li>使用GraphQL客户端(可能用于数据查询)</li>
    </ul>
  </li>
</ol>

<p>总的来说,这是一个功能丰富的DeFi应用,实现了代币交换、流动性提供、质押等核心功能。项目使用了现代化的前端技术栈,并且考虑了多链支持和特殊代币(如带有转账费用的代币)的处理。项目结构清晰,分离了核心逻辑(SDK)和用户界面,有利于代码的维护和扩展。</p>


            <div class="lesson-footer">
                <p>最后更新于 </p>
                
            </div>

            <div class="pagination">
                
                
            </div>
        </main>
    </div>

    <!-- 侧边栏切换按钮 -->
    <button class="sidebar-toggle" id="sidebarToggle" aria-label="切换目录">
        <svg viewBox="0 0 24 24" fill="white">
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" />
        </svg>
    </button>

    <footer>
    <div class="container">
        <p>&copy; 2025 Top3 Academy. All rights reserved. | <a
                href="https://learnweb3.top">learnweb3.top</a> | Made by <a href="https://x.com/Onefly"
                target="_blank">Onefly</a></p>
    </div>
</footer>
    <script>
    (function () {
        // 主题切换
        const themeToggle = document.getElementById('themeToggle');
        const prismLight = document.getElementById('prism-light');
        const prismDark = document.getElementById('prism-dark');

        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            if (theme === 'dark') {
                if (prismLight) prismLight.disabled = true;
                if (prismDark) prismDark.disabled = false;
            } else {
                if (prismLight) prismLight.disabled = false;
                if (prismDark) prismDark.disabled = true;
            }
        }

        const savedTheme = localStorage.getItem('theme') || 'light';
        setTheme(savedTheme);

        if (themeToggle) {
            themeToggle.addEventListener('click', function () {
                const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
                setTheme(currentTheme === 'dark' ? 'light' : 'dark');
            });
        }

        // 移动端菜单
        const menuToggle = document.getElementById('menuToggle');
        const mainNav = document.getElementById('mainNav');

        if (menuToggle && mainNav) {
            menuToggle.addEventListener('click', function () {
                this.classList.toggle('active');
                mainNav.classList.toggle('open');
                document.body.style.overflow = mainNav.classList.contains('open') ? 'hidden' : '';
            });

            mainNav.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', () => {
                    menuToggle.classList.remove('active');
                    mainNav.classList.remove('open');
                    document.body.style.overflow = '';
                });
            });
        }
    })();
</script>

<!-- Mermaid JS -->
<script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';

    // Unified Mermaid Loader
    (function () {
        async function initMermaid() {
            // Avoid running twice
            if (window._mermaidInitialized) return;
            window._mermaidInitialized = true;

            // 1. Find all potential Mermaid blocks
            // Strategy: Look for 'language-mermaid' class OR content starting with keywords
            const codeBlocks = document.querySelectorAll('pre code');

            const keywords = ['sequenceDiagram', 'mindmap', 'graph', 'flowchart', 'classDiagram', 'gantt', 'pie'];
            const mermaidNodes = [];

            codeBlocks.forEach(block => {
                let isMermaid = false;
                const text = block.textContent.trim();

                // Check class
                if (block.classList.contains('language-mermaid') || block.closest('.language-mermaid')) {
                    isMermaid = true;
                }
                // Check content keywords
                else {
                    for (const kw of keywords) {
                        if (text.startsWith(kw)) {
                            isMermaid = true;
                            break;
                        }
                    }
                }

                if (isMermaid) {
                    const div = document.createElement('div');
                    div.className = 'mermaid';
                    div.style.textAlign = 'center';
                    div.style.background = 'var(--bg-tertiary)';
                    div.style.padding = '20px';
                    div.style.borderRadius = '12px';
                    div.textContent = text;
                    mermaidNodes.push({ block, div });
                }
            });

            // 2. Perform replacements
            mermaidNodes.forEach(({ block, div }) => {
                const pre = block.closest('pre');
                const wrapper = pre.closest('div.highlighter-rouge, div.highlight');
                if (wrapper) {
                    wrapper.replaceWith(div);
                } else if (pre) {
                    pre.replaceWith(div);
                } else {
                    block.replaceWith(div);
                }
            });

            // 3. Initialize and Run Mermaid
            // We use var() for colors that change between themes to ensure dynamic switching works
            const style = getComputedStyle(document.body);
            const primary = style.getPropertyValue('--primary').trim();

            mermaid.initialize({
                startOnLoad: false,
                theme: 'base',
                themeVariables: {
                    fontFamily: 'Inter, sans-serif',
                    primaryColor: primary,
                    primaryTextColor: '#fff',
                    primaryBorderColor: primary,
                    lineColor: 'var(--text-primary)',
                    secondaryColor: 'var(--bg-secondary)',
                    tertiaryColor: 'var(--bg-tertiary)',
                    textColor: 'var(--text-primary)',
                    signalTextColor: 'var(--text-primary)',
                    actorTextColor: '#fff',
                    noteTextColor: 'var(--text-primary)',
                    loopTextColor: 'var(--text-primary)',
                    activationBorderColor: primary
                }
            });

            const allMermaidDivs = document.querySelectorAll('.mermaid');
            if (allMermaidDivs.length > 0) {
                await mermaid.run({
                    querySelector: '.mermaid'
                });
            }
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initMermaid);
        } else {
            initMermaid();
        }
    })();
</script>

    <!-- 侧边栏脚本 -->
    <script>
        (function () {
            const sidebar = document.getElementById('sidebar');
            const sidebarToggle = document.getElementById('sidebarToggle');
            const sidebarOverlay = document.getElementById('sidebarOverlay');

            function toggleSidebar() {
                sidebar.classList.toggle('open');
                sidebarOverlay.classList.toggle('visible');
                document.body.style.overflow = sidebar.classList.contains('open') ? 'hidden' : '';
            }

            function closeSidebar() {
                sidebar.classList.remove('open');
                sidebarOverlay.classList.remove('visible');
                document.body.style.overflow = '';
            }

            if (sidebarToggle) sidebarToggle.addEventListener('click', toggleSidebar);
            if (sidebarOverlay) sidebarOverlay.addEventListener('click', closeSidebar);

            document.querySelectorAll('.lesson-nav a').forEach(link => {
                link.addEventListener('click', closeSidebar);
            });

            document.addEventListener('keydown', e => {
                if (e.key === 'Escape') closeSidebar();
            });
        })();
    </script>
</body>

</html>