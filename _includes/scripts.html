<script>
    (function () {
        // 主题切换
        const themeToggle = document.getElementById('themeToggle');
        const prismLight = document.getElementById('prism-light');
        const prismDark = document.getElementById('prism-dark');

        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            if (theme === 'dark') {
                if (prismLight) prismLight.disabled = true;
                if (prismDark) prismDark.disabled = false;
            } else {
                if (prismLight) prismLight.disabled = false;
                if (prismDark) prismDark.disabled = true;
            }
        }

        const savedTheme = localStorage.getItem('theme') || 'light';
        setTheme(savedTheme);

        if (themeToggle) {
            themeToggle.addEventListener('click', function () {
                const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
                setTheme(currentTheme === 'dark' ? 'light' : 'dark');
            });
        }

        // 移动端菜单
        const menuToggle = document.getElementById('menuToggle');
        const mainNav = document.getElementById('mainNav');

        if (menuToggle && mainNav) {
            menuToggle.addEventListener('click', function () {
                this.classList.toggle('active');
                mainNav.classList.toggle('open');
                document.body.style.overflow = mainNav.classList.contains('open') ? 'hidden' : '';
            });

            mainNav.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', () => {
                    menuToggle.classList.remove('active');
                    mainNav.classList.remove('open');
                    document.body.style.overflow = '';
                });
            });
        }
    })();
</script>

<!-- Mermaid JS -->
<script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';

    // Get theme colors from CSS variables
    const style = getComputedStyle(document.body);
    const primary = style.getPropertyValue('--primary').trim();
    const secondary = style.getPropertyValue('--bg-secondary').trim();
    const textPrimary = style.getPropertyValue('--text-primary').trim();

    mermaid.initialize({
        startOnLoad: false,
        theme: 'base',
        themeVariables: {
            fontFamily: 'Inter, sans-serif',
            primaryColor: primary,
            primaryTextColor: '#fff',
            primaryBorderColor: primary,
            lineColor: textPrimary,
            secondaryColor: secondary,
            tertiaryColor: '#f1f5f9'
        }
    });

    document.addEventListener('DOMContentLoaded', async () => {
        const mermaidBlocks = document.querySelectorAll('pre code.language-mermaid');
        if (mermaidBlocks.length > 0) {
            mermaidBlocks.forEach(block => {
                const div = document.createElement('div');
                div.className = 'mermaid';
                div.style.textAlign = 'center'; // Center the diagram
                div.style.background = 'var(--bg-tertiary)'; // Add subtle background
                div.style.padding = '20px';
                div.style.borderRadius = '12px';
                div.textContent = block.textContent;
                // Replace pre element with the new div
                block.parentElement.replaceWith(div);
            });

            await mermaid.run({
                querySelector: '.mermaid'
            });
        }
    });
</script>